<!doctype html>
<html lang="en">
<head>
 <meta charset="utf-8">
 <title>chat app</title>
 <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
 <script src="https:///code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
 <style>
 #messages {border-color:#999; border-style:solid; width:500px; min-height:300px; margin:5px;}
 .msg {color:#000; background-color:#fff; padding:2px; margin:2px;}
 .server {color:#999; background-color:white; font-size:small;}
 #form {margin:5px;}
 #form input {width:250px;}
 </style>
</head>
<body>
 <div id="messages"></div>
 <form id="form" onsubmit="return false;">
 <input id="text" type="text" onkeypress="return sendText(event)" />
 </form>

 <script type="text/javascript">

 // Open a websocket using FRED.
 var publishSocket = new WebSocket("ws://34.253.209.199:1880/api/public/messagereceive");
 var listenSocket = new WebSocket("ws://34.253.209.199:1880/api/public/messagepublish");

 listenSocket.onmessage = function (event) {
 // When receiving a message append a div child to #messages
 data = JSON.parse(event.data);
 $("#messages").append("<div class='msg' >"+data.timestamp+" - "+data.msg+"</div>")
 if ($("#messages").children().length > 10 ) { $("#messages :first-child").remove()}
 }

 listenSocket.onclose = function(event){
 $("#messages").append("<div class='msg server'>Disconnected from CONSULT server.</div>");
 }

 listenSocket.onopen = function(event){
 $("#messages").append("<div class='msg server'>Welcome to CONSULT. How can I help you today?</div>")
 }

 function sendText(event) {
 // Only if return key pressed
 if (event.keyCode == 13) {
 // Construct object containing the data the server needs.
 d = new Date();
 var data = {
 msg: $("#text").val(),
 timestamp: d.getHours() +":"+ d.getMinutes() + ":" + d.getSeconds()
 };
 // Send the msg object as a JSON-formatted string.
 publishSocket.send(JSON.stringify(data));
 // Blank the text input element
 $("#text").val("");
 }
 }
 </script>

</body>
</html>